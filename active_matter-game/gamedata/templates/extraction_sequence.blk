extraction_sequence_affect{
  _use:t="game_effect_sequence"
  extraction_sequence_affect__testMode:b=no

  "extraction_sequence_affect:tag"{}
  "spawn_sequence__fxEid:eid"{}
  "locked_weapon__reload:tag"{}
  "state__interruptReload:tag"{}
  "entity_mod_effects:object"{
    "hitpointsDmgMult+mult_diminishing":r=0
  }

  "game_effect_sequence__stages:array"{
    "stage:object"{
      affectTemplate:t="extraction_sequence_init"
      duration:r=0.25
    }

    "stage:object"{
      affectTemplate:t="extraction_sequence_portal_opens"
      duration:r=0.1
      setupTransform:b=yes
    }

    "stage:object"{
      affectTemplate:t="extraction_sequence_soldier_disappears+trans_portal_affect_start_sound"
      duration:r=1
    }
  }

  "extraction_sequence_affect__finalStageTest:object"{
    affectTemplate:t="extraction_sequence_give_control"
    duration:r=1
  }

  "extraction_sequence_affect__finalStage:object"{
    affectTemplate:t="extraction_sequence_process_extraction"
    duration:r=1
  }
}

extraction_sequence_affect_for_device{
  _use:t="extraction_sequence_affect"

  "extraction_sequence_affect__finalStage:object"{
    affectTemplate:t="extraction_sequence_process_destroy"
    duration:r=1
  }
}

menu_extraction_sequence_affect{
  _use:t="extraction_sequence_affect"
  game_effect_server_sound__appear:t="onBattleStart"
  menu_extraction_sequence_affect__isOffline:b=no

  "extraction_sequence_affect__finalStage:object"{
    affectTemplate:t="extraction_sequence_connect_to_host"
    duration:r=1
  }
}

extraction_sequence_start_on_appear{
  extraction_sequence_start_on_appear__templateName:t="extraction_sequence_affect"
  extraction_sequence_start_on_appear__delay:r=1.5
  extraction_sequence_start_on_appear__testMode:b=yes
}

extraction_sequence_init{
  _use:t="replicated_effect_with_duration"
  game_effect__clientReplaceTemplateFrom:t="human_hero_components_local"
  game_effect__clientReplaceTemplateTo:t="extraction_sequence_hero_client"
  game_effect__addTemplate:t="extraction_sequence_hero_server"

  "spawn_sequence_game_effect__gameClientAffects:array"{
    "human_extraction_aura_affect:object"{
      fps:t="human_extraction_aura_affect_fps"
      tps:t="human_extraction_aura_affect_tps"
      time:r=1.5
    }
  }
}

extraction_sequence_invisibility{
  "game_effect__invisibility:tag"{}
  "game_effect__invisibleBody:tag"{}
  "game_effect__disableMapHighlight:tag"{}
  "game_effect__disableHumanMapHighlight:tag"{}
  "game_effect__disableCollision:tag"{}
}

extraction_sequence_hero_client{
  "hero:tag"{}
  "suspendedPlayerControl:tag"{}
}

extraction_sequence_hero_server{
  _use:t="invulnerable"
}

extraction_sequence_portal_effect{
  _use:t="ecs_no_debug"
  transform:m=[[1, 0, 0] [0, 1, 0] [0, 0, 1] [0, 0, 0]]
  effect__scale:r=1
  _tracked:t="effect__scale"

  effect{
    _tags:t="render"
  }

  _group{
    _tags:t="render"
    effect__name:t="relocation_character_a_composite_fx"
  }
}

extraction_sequence_portal{
  _use:t="extraction_visual_effect"
  _use:t="spawn_sequence_portal_base"
  _use:t="extraction_sequence_portal_effect"
  portal__scales:p2=0.001, 0.9
  portal__openCloseTime:p2=0.65, 0.85
  portal__radiusOffset:r=0.2
  hero_spawn_portal__scaleAnimationTemplate:t="militant_extraction_sequence_scale_animation"

  "hero_spawn_portal__openEffects:object"{}
  "hero_spawn_portal__effects:list<eid>"{}
  "hero_spawn_portal:tag"{}
}

militant_extraction_sequence_scale_animation{
  _use:t="militant_sequence_scale_animation"
  militant_extraction_sequence_scale_animation__portalOffset:r=0.45
  militant_extraction_sequence_scale_animation__time:r=1.3
  militant_extraction_sequence_scale_animation__initialDelay:r=0.1
  militant_extraction_sequence_scale_animation__endScale:r=0.1
  militant_extraction_sequence_scale_animation__progress:r=0
  militant_extraction_sequence_scale_animation__finalDelay:r=0.3
}

militant_extraction_sequence_fov_affect{
  _use:t="client_game_effect_with_duration"
  game_effect__timeToDestroy:r=0.95
  militant_extraction_sequence_fov_affect__endMagnification:r=0.05
  militant_extraction_sequence_fov_affect__normalizerTemplate:t="human_cam_magnification_normalizer_affect"
}

extraction_sequence_portal_opens{
  _use:t="replicated_effect_with_duration"
  spawn_sequence__fxTempl:t="extraction_sequence_portal"
  spawn_sequence__fxOffset:p3=0, 1.75, 0
}

extraction_sequence_soldier_disappears{
  _use:t="replicated_effect_with_duration"
  _use:t="base_postfx_fade_affect"
  extraction_sequence__soldierDisappearsAffect:t="militant_extraction_sequence_fov_affect"
  postfx_fade_affect__fadeInTime:r=1
  postfx_fade_affect__fadeColor:c=5, 7, 5, 255
  postfx_fade_affect__affectOnlyLocal:b=yes
}

extraction_sequence_give_control{
  _use:t="replicated_effect_with_duration"
  _use:t="base_postfx_fade_affect"
  _use:t="extraction_sequence_invisibility"
  game_effect__clientReplaceTemplateFrom:t="extraction_sequence_hero_client"
  game_effect__clientReplaceTemplateTo:t="human_hero_components_local"
  game_effect__subtractTemplate:t="extraction_sequence_hero_server"
  postfx_fade_affect__fadeOutTime:r=2.5
}

extraction_sequence_process_extraction{
  _use:t="replicated_effect_with_duration"
  _use:t="extraction_sequence_invisibility"

  "extraction_sequence__processExtraction:tag"{}
}

extraction_sequence_process_destroy{
  _use:t="replicated_effect_with_duration"
  _use:t="extraction_sequence_invisibility"

  "extraction_sequence__processDestroy:tag"{}
}

extraction_sequence_connect_to_host{
  "extraction_sequence__connectToHost:tag"{}
}
